{"payload":"{\"code\":\"{\\\"v\\\":2,\\\"language\\\":\\\"JS\\\",\\\"entry\\\":\\\"index.js\\\",\\\"imports\\\":{},\\\"files\\\":{\\\"index.js\\\":\\\"export const createScene = async function () { const canvas = document.getElementById(\\\\\\\"renderCanvas\\\\\\\"); const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true }); const scene = new BABYLON.Scene(engine); new BABYLON.HemisphericLight(\\\\\\\"hemi\\\\\\\", new BABYLON.Vector3(0, 1, 0), scene); const ground = BABYLON.MeshBuilder.CreateGround(\\\\\\\"ground\\\\\\\", { width: 10, height: 10 }, scene); scene.createDefaultCamera(true, false, true); var camera = new BABYLON.ArcRotateCamera(\\\\\\\"camera\\\\\\\", 0, 1, 10, BABYLON.Vector3.Zero(), scene); camera.attachControl(canvas, true); const xr = await scene.createDefaultXRExperienceAsync({ uiOptions: { sessionMode: \\\\\\\"immersive-ar\\\\\\\" }, optionalFeatures: true, }); const manager = new BABYLON.GUI.GUI3DManager(scene); const panel3D = new BABYLON.GUI.StackPanel3D(); panel3D.margin = 0.03; manager.addControl(panel3D); panel3D.position = new BABYLON.Vector3(0, 1.5, 1.5); function add3DButton(text, onClick) { const btn = new BABYLON.GUI.HolographicButton(\\\\\\\"btn_\\\\\\\" + text); btn.text = text; btn.onPointerUpObservable.add(onClick); panel3D.addControl(btn); return btn; } const ui = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(\\\\\\\"hud\\\\\\\", true, scene); const hint = new BABYLON.GUI.TextBlock(); hint.text = \\\\\\\"Controls: a = Walk x = Smile y = Confuse\\\\\\\"; hint.color = \\\\\\\"white\\\\\\\"; hint.fontSize = 22; hint.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT; hint.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP; hint.paddingLeft = \\\\\\\"14px\\\\\\\"; hint.paddingTop = \\\\\\\"14px\\\\\\\"; hint.outlineColor = \\\\\\\"black\\\\\\\"; hint.outlineWidth = 4; ui.addControl(hint); const fileInput = document.createElement(\\\\\\\"input\\\\\\\"); fileInput.type = \\\\\\\"file\\\\\\\"; fileInput.accept = \\\\\\\".glb,.gltf\\\\\\\"; fileInput.style.display = \\\\\\\"none\\\\\\\"; document.body.appendChild(fileInput); add3DButton(\\\\\\\"ðŸ“‚ Load GLB/GLTF\\\\\\\", () => fileInput.click()); let currentRoot = null; let allGroups = []; let walk = null, smile = null, confused = null; const stopAllFace = () => { if (smile) smile.stop(); if (confused) confused.stop(); }; function pickAnimations() { allGroups = scene.animationGroups || []; const lc = s => (s || \\\\\\\"\\\\\\\").toLowerCase(); const byName = key => allGroups.find(g => lc(g.name).includes(key)); walk = byName(\\\\\\\"walk\\\\\\\") || null; smile = byName(\\\\\\\"smile\\\\\\\") || null; confused = byName(\\\\\\\"confuse\\\\\\\") || null; } function toggleWalk() { if (!walk) return; if (walk.isPlaying) walk.stop(); else { walk.reset(); walk.start(true, 1.0); } } function playSmile() { stopAllFace(); if (smile) { smile.reset(); smile.start(true, 1.0); } } function playConfused() { stopAllFace(); if (confused) { confused.reset(); confused.start(true, 1.0); } } fileInput.addEventListener(\\\\\\\"change\\\\\\\", async (ev) => { const file = ev.target.files?.[0]; if (!file) return; scene.meshes.filter(m => m !== ground).forEach(m => m.dispose()); scene.animationGroups.slice().forEach(g => g.dispose()); walk = smile = confused = null; allGroups = []; currentRoot = null; try { const result = await BABYLON.SceneLoader.AppendAsync(\\\\\\\"file:\\\\\\\", file, scene); currentRoot = result.meshes.find(m => m && m.name && m !== ground) || result.meshes[0]; if (currentRoot?.scaling) currentRoot.scaling.setAll(0.2); pickAnimations(); } catch (e) { console.error(\\\\\\\"Load error:\\\\\\\", e); } finally { fileInput.value = \\\\\\\"\\\\\\\"; } }); const ctrls = { left: null, right: null }; xr.input.onControllerAddedObservable.add(c => { const h = c.inputSource?.handedness; if (h) ctrls[h] = c; }); xr.input.onControllerRemovedObservable.add(c => { const h = c.inputSource?.handedness; if (h && ctrls[h] === c) ctrls[h] = null; }); let prev = { A: false, X: false, Y: false }; function anyPressed(ctrl, idxs) { if (!ctrl?.inputSource?.gamepad) return false; const bs = ctrl.inputSource.gamepad.buttons || []; for (const i of idxs) { const b = bs[i]; if (b && b.pressed) return true; } return false; } scene.onBeforeRenderObservable.add(() => { const A = anyPressed(ctrls.right, [0,1,2,3,4,5]); const X = anyPressed(ctrls.left, [0,3,4,5,1,2]); const Y = anyPressed(ctrls.left, [1,4,5,3,0,2]); if (A && !prev.A) toggleWalk(); if (X && !prev.X) playSmile(); if (Y && !prev.Y) playConfused(); prev = { A, X, Y }; }); window.addEventListener(\\\\\\\"keydown\\\\\\\", (e) => { const k = e.key.toLowerCase(); if (k === \\\\\\\"a\\\\\\\") toggleWalk(); if (k === \\\\\\\"x\\\\\\\") playSmile(); if (k === \\\\\\\"y\\\\\\\") playConfused(); }); engine.runRenderLoop(() => scene.render()); window.addEventListener(\\\\\\\"resize\\\\\\\", () => engine.resize()); return scene; };\\\"}}\",\"unicode\":\"eyJ2IjoyLCJsYW5ndWFnZSI6IkpTIiwiZW50cnkiOiJpbmRleC5qcyIsImltcG9ydHMiOnt9LCJmaWxlcyI6eyJpbmRleC5qcyI6ImV4cG9ydCBjb25zdCBjcmVhdGVTY2VuZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHsgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZW5kZXJDYW52YXNcIik7IGNvbnN0IGVuZ2luZSA9IG5ldyBCQUJZTE9OLkVuZ2luZShjYW52YXMsIHRydWUsIHsgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiB0cnVlLCBzdGVuY2lsOiB0cnVlIH0pOyBjb25zdCBzY2VuZSA9IG5ldyBCQUJZTE9OLlNjZW5lKGVuZ2luZSk7IG5ldyBCQUJZTE9OLkhlbWlzcGhlcmljTGlnaHQoXCJoZW1pXCIsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMSwgMCksIHNjZW5lKTsgY29uc3QgZ3JvdW5kID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVHcm91bmQoXCJncm91bmRcIiwgeyB3aWR0aDogMTAsIGhlaWdodDogMTAgfSwgc2NlbmUpOyBzY2VuZS5jcmVhdGVEZWZhdWx0Q2FtZXJhKHRydWUsIGZhbHNlLCB0cnVlKTsgdmFyIGNhbWVyYSA9IG5ldyBCQUJZTE9OLkFyY1JvdGF0ZUNhbWVyYShcImNhbWVyYVwiLCAwLCAxLCAxMCwgQkFCWUxPTi5WZWN0b3IzLlplcm8oKSwgc2NlbmUpOyBjYW1lcmEuYXR0YWNoQ29udHJvbChjYW52YXMsIHRydWUpOyBjb25zdCB4ciA9IGF3YWl0IHNjZW5lLmNyZWF0ZURlZmF1bHRYUkV4cGVyaWVuY2VBc3luYyh7IHVpT3B0aW9uczogeyBzZXNzaW9uTW9kZTogXCJpbW1lcnNpdmUtYXJcIiB9LCBvcHRpb25hbEZlYXR1cmVzOiB0cnVlLCB9KTsgY29uc3QgbWFuYWdlciA9IG5ldyBCQUJZTE9OLkdVSS5HVUkzRE1hbmFnZXIoc2NlbmUpOyBjb25zdCBwYW5lbDNEID0gbmV3IEJBQllMT04uR1VJLlN0YWNrUGFuZWwzRCgpOyBwYW5lbDNELm1hcmdpbiA9IDAuMDM7IG1hbmFnZXIuYWRkQ29udHJvbChwYW5lbDNEKTsgcGFuZWwzRC5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMS41LCAxLjUpOyBmdW5jdGlvbiBhZGQzREJ1dHRvbih0ZXh0LCBvbkNsaWNrKSB7IGNvbnN0IGJ0biA9IG5ldyBCQUJZTE9OLkdVSS5Ib2xvZ3JhcGhpY0J1dHRvbihcImJ0bl9cIiArIHRleHQpOyBidG4udGV4dCA9IHRleHQ7IGJ0bi5vblBvaW50ZXJVcE9ic2VydmFibGUuYWRkKG9uQ2xpY2spOyBwYW5lbDNELmFkZENvbnRyb2woYnRuKTsgcmV0dXJuIGJ0bjsgfSBjb25zdCB1aSA9IEJBQllMT04uR1VJLkFkdmFuY2VkRHluYW1pY1RleHR1cmUuQ3JlYXRlRnVsbHNjcmVlblVJKFwiaHVkXCIsIHRydWUsIHNjZW5lKTsgY29uc3QgaGludCA9IG5ldyBCQUJZTE9OLkdVSS5UZXh0QmxvY2soKTsgaGludC50ZXh0ID0gXCJDb250cm9sczogYSA9IFdhbGsgeCA9IFNtaWxlIHkgPSBDb25mdXNlXCI7IGhpbnQuY29sb3IgPSBcIndoaXRlXCI7IGhpbnQuZm9udFNpemUgPSAyMjsgaGludC50ZXh0SG9yaXpvbnRhbEFsaWdubWVudCA9IEJBQllMT04uR1VJLkNvbnRyb2wuSE9SSVpPTlRBTF9BTElHTk1FTlRfTEVGVDsgaGludC50ZXh0VmVydGljYWxBbGlnbm1lbnQgPSBCQUJZTE9OLkdVSS5Db250cm9sLlZFUlRJQ0FMX0FMSUdOTUVOVF9UT1A7IGhpbnQucGFkZGluZ0xlZnQgPSBcIjE0cHhcIjsgaGludC5wYWRkaW5nVG9wID0gXCIxNHB4XCI7IGhpbnQub3V0bGluZUNvbG9yID0gXCJibGFja1wiOyBoaW50Lm91dGxpbmVXaWR0aCA9IDQ7IHVpLmFkZENvbnRyb2woaGludCk7IGNvbnN0IGZpbGVJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTsgZmlsZUlucHV0LnR5cGUgPSBcImZpbGVcIjsgZmlsZUlucHV0LmFjY2VwdCA9IFwiLmdsYiwuZ2x0ZlwiOyBmaWxlSW5wdXQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVJbnB1dCk7IGFkZDNEQnV0dG9uKFwi8J+TgiBMb2FkIEdMQi9HTFRGXCIsICgpID0+IGZpbGVJbnB1dC5jbGljaygpKTsgbGV0IGN1cnJlbnRSb290ID0gbnVsbDsgbGV0IGFsbEdyb3VwcyA9IFtdOyBsZXQgd2FsayA9IG51bGwsIHNtaWxlID0gbnVsbCwgY29uZnVzZWQgPSBudWxsOyBjb25zdCBzdG9wQWxsRmFjZSA9ICgpID0+IHsgaWYgKHNtaWxlKSBzbWlsZS5zdG9wKCk7IGlmIChjb25mdXNlZCkgY29uZnVzZWQuc3RvcCgpOyB9OyBmdW5jdGlvbiBwaWNrQW5pbWF0aW9ucygpIHsgYWxsR3JvdXBzID0gc2NlbmUuYW5pbWF0aW9uR3JvdXBzIHx8IFtdOyBjb25zdCBsYyA9IHMgPT4gKHMgfHwgXCJcIikudG9Mb3dlckNhc2UoKTsgY29uc3QgYnlOYW1lID0ga2V5ID0+IGFsbEdyb3Vwcy5maW5kKGcgPT4gbGMoZy5uYW1lKS5pbmNsdWRlcyhrZXkpKTsgd2FsayA9IGJ5TmFtZShcIndhbGtcIikgfHwgbnVsbDsgc21pbGUgPSBieU5hbWUoXCJzbWlsZVwiKSB8fCBudWxsOyBjb25mdXNlZCA9IGJ5TmFtZShcImNvbmZ1c2VcIikgfHwgbnVsbDsgfSBmdW5jdGlvbiB0b2dnbGVXYWxrKCkgeyBpZiAoIXdhbGspIHJldHVybjsgaWYgKHdhbGsuaXNQbGF5aW5nKSB3YWxrLnN0b3AoKTsgZWxzZSB7IHdhbGsucmVzZXQoKTsgd2Fsay5zdGFydCh0cnVlLCAxLjApOyB9IH0gZnVuY3Rpb24gcGxheVNtaWxlKCkgeyBzdG9wQWxsRmFjZSgpOyBpZiAoc21pbGUpIHsgc21pbGUucmVzZXQoKTsgc21pbGUuc3RhcnQodHJ1ZSwgMS4wKTsgfSB9IGZ1bmN0aW9uIHBsYXlDb25mdXNlZCgpIHsgc3RvcEFsbEZhY2UoKTsgaWYgKGNvbmZ1c2VkKSB7IGNvbmZ1c2VkLnJlc2V0KCk7IGNvbmZ1c2VkLnN0YXJ0KHRydWUsIDEuMCk7IH0gfSBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBhc3luYyAoZXYpID0+IHsgY29uc3QgZmlsZSA9IGV2LnRhcmdldC5maWxlcz8uWzBdOyBpZiAoIWZpbGUpIHJldHVybjsgc2NlbmUubWVzaGVzLmZpbHRlcihtID0+IG0gIT09IGdyb3VuZCkuZm9yRWFjaChtID0+IG0uZGlzcG9zZSgpKTsgc2NlbmUuYW5pbWF0aW9uR3JvdXBzLnNsaWNlKCkuZm9yRWFjaChnID0+IGcuZGlzcG9zZSgpKTsgd2FsayA9IHNtaWxlID0gY29uZnVzZWQgPSBudWxsOyBhbGxHcm91cHMgPSBbXTsgY3VycmVudFJvb3QgPSBudWxsOyB0cnkgeyBjb25zdCByZXN1bHQgPSBhd2FpdCBCQUJZTE9OLlNjZW5lTG9hZGVyLkFwcGVuZEFzeW5jKFwiZmlsZTpcIiwgZmlsZSwgc2NlbmUpOyBjdXJyZW50Um9vdCA9IHJlc3VsdC5tZXNoZXMuZmluZChtID0+IG0gJiYgbS5uYW1lICYmIG0gIT09IGdyb3VuZCkgfHwgcmVzdWx0Lm1lc2hlc1swXTsgaWYgKGN1cnJlbnRSb290Py5zY2FsaW5nKSBjdXJyZW50Um9vdC5zY2FsaW5nLnNldEFsbCgwLjIpOyBwaWNrQW5pbWF0aW9ucygpOyB9IGNhdGNoIChlKSB7IGNvbnNvbGUuZXJyb3IoXCJMb2FkIGVycm9yOlwiLCBlKTsgfSBmaW5hbGx5IHsgZmlsZUlucHV0LnZhbHVlID0gXCJcIjsgfSB9KTsgY29uc3QgY3RybHMgPSB7IGxlZnQ6IG51bGwsIHJpZ2h0OiBudWxsIH07IHhyLmlucHV0Lm9uQ29udHJvbGxlckFkZGVkT2JzZXJ2YWJsZS5hZGQoYyA9PiB7IGNvbnN0IGggPSBjLmlucHV0U291cmNlPy5oYW5kZWRuZXNzOyBpZiAoaCkgY3RybHNbaF0gPSBjOyB9KTsgeHIuaW5wdXQub25Db250cm9sbGVyUmVtb3ZlZE9ic2VydmFibGUuYWRkKGMgPT4geyBjb25zdCBoID0gYy5pbnB1dFNvdXJjZT8uaGFuZGVkbmVzczsgaWYgKGggJiYgY3RybHNbaF0gPT09IGMpIGN0cmxzW2hdID0gbnVsbDsgfSk7IGxldCBwcmV2ID0geyBBOiBmYWxzZSwgWDogZmFsc2UsIFk6IGZhbHNlIH07IGZ1bmN0aW9uIGFueVByZXNzZWQoY3RybCwgaWR4cykgeyBpZiAoIWN0cmw/LmlucHV0U291cmNlPy5nYW1lcGFkKSByZXR1cm4gZmFsc2U7IGNvbnN0IGJzID0gY3RybC5pbnB1dFNvdXJjZS5nYW1lcGFkLmJ1dHRvbnMgfHwgW107IGZvciAoY29uc3QgaSBvZiBpZHhzKSB7IGNvbnN0IGIgPSBic1tpXTsgaWYgKGIgJiYgYi5wcmVzc2VkKSByZXR1cm4gdHJ1ZTsgfSByZXR1cm4gZmFsc2U7IH0gc2NlbmUub25CZWZvcmVSZW5kZXJPYnNlcnZhYmxlLmFkZCgoKSA9PiB7IGNvbnN0IEEgPSBhbnlQcmVzc2VkKGN0cmxzLnJpZ2h0LCBbMCwxLDIsMyw0LDVdKTsgY29uc3QgWCA9IGFueVByZXNzZWQoY3RybHMubGVmdCwgWzAsMyw0LDUsMSwyXSk7IGNvbnN0IFkgPSBhbnlQcmVzc2VkKGN0cmxzLmxlZnQsIFsxLDQsNSwzLDAsMl0pOyBpZiAoQSAmJiAhcHJldi5BKSB0b2dnbGVXYWxrKCk7IGlmIChYICYmICFwcmV2LlgpIHBsYXlTbWlsZSgpOyBpZiAoWSAmJiAhcHJldi5ZKSBwbGF5Q29uZnVzZWQoKTsgcHJldiA9IHsgQSwgWCwgWSB9OyB9KTsgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7IGNvbnN0IGsgPSBlLmtleS50b0xvd2VyQ2FzZSgpOyBpZiAoayA9PT0gXCJhXCIpIHRvZ2dsZVdhbGsoKTsgaWYgKGsgPT09IFwieFwiKSBwbGF5U21pbGUoKTsgaWYgKGsgPT09IFwieVwiKSBwbGF5Q29uZnVzZWQoKTsgfSk7IGVuZ2luZS5ydW5SZW5kZXJMb29wKCgpID0+IHNjZW5lLnJlbmRlcigpKTsgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4gZW5naW5lLnJlc2l6ZSgpKTsgcmV0dXJuIHNjZW5lOyB9OyJ9fQ==\",\"engine\":\"WebGL2\",\"version\":2}","name":"Lec_17_handson","description":"","tags":""}